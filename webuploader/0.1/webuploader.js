/*
 WebUploader 0.1.5 */
(function(x,m){var B={},g=function(a,b){var d;if("string"===typeof a)return h(a);var e=[];var f=a.length;for(d=0;d<f;d++)e.push(h(a[d]));return b.apply(null,e)},k=function(a,b,d){2===arguments.length&&(d=b,b=null);g(b||[],function(){var b=arguments,e={exports:d};"function"===typeof d&&(b.length||(b=[g,e.exports,e]),b=d.apply(null,b),void 0!==b&&(e.exports=b));B[a]=e.exports})},h=function(a){var b=B[a]||x[a];if(!b)throw Error("`"+a+"` is undefined");return b},c=function(a){var b,d,e;var c=function(a){return a&&
a.charAt(0).toUpperCase()+a.substr(1)};for(b in B){var u=a;if(B.hasOwnProperty(b)){var h=b.split("/");for(e=c(h.pop());d=c(h.shift());)u[d]=u[d]||{},u=u[d];u[e]=B[b]}}return a},b=function(a){x.__dollar=a;return c(m(x,k,g))};if("object"===typeof module&&"object"===typeof module.exports)module.exports=b();else if("function"===typeof define&&define.amd)define(["jquery"],b);else{var a=x.WebUploader;x.WebUploader=b();x.WebUploader.noConflict=function(){x.WebUploader=a}}})(window,function(x,m,B){m("dollar-third",
[],function(){var g=x.__dollar||x.jQuery||x.Zepto;if(!g)throw Error("jQuery or Zepto not found!");return g});m("dollar",["dollar-third"],function(g){return g});m("promise-third",["dollar"],function(g){return{Deferred:g.Deferred,when:g.when,isPromise:function(g){return g&&"function"===typeof g.then}}});m("promise",["promise-third"],function(g){return g});m("base",["dollar","promise"],function(g,k){function h(a,b){return function(){return a.apply(b,arguments)}}function c(a){if(Object.create)return Object.create(a);
var b=function(){};b.prototype=a;return new b}var b=function(){},a=Function.call,e=k.Deferred,f=k.isPromise;k=k.when;var d=function(a){var b={},d=a.match(/WebKit\/([\d.]+)/),e=a.match(/Chrome\/([\d.]+)/)||a.match(/CriOS\/([\d.]+)/),q=a.match(/MSIE\s([\d\.]+)/)||a.match(/(?:trident)(?:.*rv:([\w.]+))?/i),f=a.match(/Firefox\/([\d.]+)/),c=a.match(/Safari\/([\d.]+)/);a=a.match(/OPR\/([\d.]+)/);d&&(b.webkit=parseFloat(d[1]));e&&(b.chrome=parseFloat(e[1]));q&&(b.ie=parseFloat(q[1]));f&&(b.firefox=parseFloat(f[1]));
c&&(b.safari=parseFloat(c[1]));a&&(b.opera=parseFloat(a[1]));return b}(navigator.userAgent),q=function(a){var b={},d=a.match(/(?:Android);?[\s\/]+([\d.]+)?/);a=a.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);d&&(b.android=parseFloat(d[1]));a&&(b.ios=parseFloat(a[1].replace(/_/g,".")));return b}(navigator.userAgent);var p=x.console?h(console.log,console):b;return{version:"0.1.5",$:g,Deferred:e,isPromise:f,when:k,browser:d,os:q,inherits:function(a,b,d){if("function"===typeof b){var e=b;b=null}else e=
b&&b.hasOwnProperty("constructor")?b.constructor:function(){return a.apply(this,arguments)};g.extend(!0,e,a,d||{});e.__super__=a.prototype;e.prototype=c(a.prototype);b&&g.extend(!0,e.prototype,b);return e},noop:b,bindFn:h,log:p,nextTick:function(){return function(a){setTimeout(a,1)}}(),slice:function(b){return function(){return a.apply(b,arguments)}}([].slice),guid:function(){var a=0;return function(b){for(var d=(+new Date).toString(32),e=0;5>e;e++)d+=Math.floor(65535*Math.random()).toString(32);
return(b||"wu_")+d+(a++).toString(32)}}(),formatSize:function(a,b,d){var e;for(d=d||["B","K","M","G","TB"];(e=d.shift())&&1024<a;)a/=1024;return("B"===e?a:a.toFixed(b||2))+e}}});m("mediator",["base"],function(g){function k(a,e,f,c){return b.grep(a,function(a){return a&&(!e||a.e===e)&&(!f||a.cb===f||a.cb._cb===f)&&(!c||a.ctx===c)})}function h(a,q,f){b.each((a||"").split(e),function(a,b){f(b,q)})}function c(a,b){for(var d=!1,e=-1,q=a.length,f;++e<q;)if(f=a[e],!1===f.cb.apply(f.ctx2,b)){d=!0;break}return!d}
var b=g.$,a=[].slice,e=/\s+/;var f={on:function(a,b,e){var d=this;if(!b)return this;var f=this._events||(this._events=[]);h(a,b,function(a,b){a={e:a};a.cb=b;a.ctx=e;a.ctx2=e||d;a.id=f.length;f.push(a)});return this},once:function(a,b,e){var d=this;if(!b)return d;h(a,b,function(a,b){var f=function(){d.off(a,f);return b.apply(e||d,arguments)};f._cb=b;d.on(a,f,e)});return d},off:function(a,e,f){var d=this._events;if(!d)return this;if(!a&&!e&&!f)return this._events=[],this;h(a,e,function(a,e){b.each(k(d,
a,e,f),function(){delete d[this.id]})});return this},trigger:function(b){if(!this._events||!b)return this;var d=a.call(arguments,1);var e=k(this._events,b);var f=k(this._events,"all");return c(e,d)&&c(f,arguments)}};return b.extend({installTo:function(a){return b.extend(a,f)}},f)});m("uploader",["base","mediator"],function(g,k){function h(b){this.options=c.extend(!0,{},h.options,b);this._init(this.options)}var c=g.$;h.options={};k.installTo(h.prototype);c.each({upload:"start-upload",stop:"stop-upload",
getFile:"get-file",getFiles:"get-files",addFile:"add-file",addFiles:"add-file",sort:"sort-files",removeFile:"remove-file",cancelFile:"cancel-file",skipFile:"skip-file",retry:"retry",isInProgress:"is-in-progress",makeThumb:"make-thumb",md5File:"md5-file",getDimension:"get-dimension",addButton:"add-btn",predictRuntimeType:"predict-runtime-type",refresh:"refresh",disable:"disable",enable:"enable",reset:"reset"},function(b,a){h.prototype[b]=function(){return this.request(a,arguments)}});c.extend(h.prototype,
{state:"pending",_init:function(b){var a=this;a.request("init",b,function(){a.state="ready";a.trigger("ready")})},option:function(b,a){var e=this.options;if(1<arguments.length)c.isPlainObject(a)&&c.isPlainObject(e[b])?c.extend(e[b],a):e[b]=a;else return b?e[b]:e},getStats:function(){var b=this.request("get-stats");return b?{successNum:b.numOfSuccess,progressNum:b.numOfProgress,cancelNum:b.numOfCancel,invalidNum:b.numOfInvalid,uploadFailNum:b.numOfUploadFailed,queueNum:b.numOfQueue,interruptNum:b.numofInterrupt}:
{}},trigger:function(b){var a=[].slice.call(arguments,1),e=this.options,f="on"+b.substring(0,1).toUpperCase()+b.substring(1);return!1===k.trigger.apply(this,arguments)||c.isFunction(e[f])&&!1===e[f].apply(this,a)||c.isFunction(this[f])&&!1===this[f].apply(this,a)||!1===k.trigger.apply(k,[this,b].concat(a))?!1:!0},destroy:function(){this.request("destroy",arguments);this.off()},request:g.noop});g.create=h.create=function(b){return new h(b)};return g.Uploader=h});m("runtime/runtime",["base","mediator"],
function(g,k){function h(a){this.options=c.extend({container:document.body},a);this.uid=g.guid("rt_")}var c=g.$,b={},a=function(a){for(var b in a)if(a.hasOwnProperty(b))return b;return null};c.extend(h.prototype,{getContainer:function(){if(this._container)return this._container;var a=c(document.body);var b=c(document.createElement("div"));b.attr("id","rt_"+this.uid);b.css({position:"absolute",zIndex:29891014,top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"});a.append(b);a.addClass("webuploader-container");
this._container=b;this._parent=a;return b},init:g.noop,exec:g.noop,destroy:function(){this._container&&this._container.remove();this._parent&&this._parent.removeClass("webuploader-container");this.off()}});h.orders="html5,flash";h.addRuntime=function(a,f){b[a]=f};h.hasRuntime=function(e){return!(e?!b[e]:!a(b))};h.create=function(e,f){f=f||h.orders;c.each(f.split(/\s*,\s*/g),function(){if(b[this])return d=this,!1});var d=d||a(b);if(!d)throw Error("Runtime Error");return new b[d](e)};k.installTo(h.prototype);
return h});m("runtime/client",["base","mediator","runtime/runtime"],function(g,k,h){function c(a,e){var f=g.Deferred(),d;this.uid=g.guid("client_");this.runtimeReady=function(a){return f.done(a)};this.connectRuntime=function(a,c){if(d)throw Error("already connected!");f.done(c);"string"===typeof a&&b.get(a)&&(d=b.get(a));(d=d||b.get(null,e))?(g.$.extend(d.options,a),d.__promise.then(f.resolve),d.__client++):(d=h.create(a,a.runtimeOrder),d.__promise=f.promise(),d.once("ready",f.resolve),d.init(),b.add(d),
d.__client=1);e&&(d.__standalone=e);return d};this.getRuntime=function(){return d};this.disconnectRuntime=function(){d&&(d.__client--,0>=d.__client&&(b.remove(d),delete d.__promise,d.destroy()),d=null)};this.exec=function(){if(d){var b=g.slice(arguments);a&&b.unshift(a);return d.exec.apply(this,b)}};this.getRuid=function(){return d&&d.uid};this.destroy=function(a){return function(){a&&a.apply(this,arguments);this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()}}(this.destroy)}
var b=function(){var a={};return{add:function(b){a[b.uid]=b},get:function(b,f){var d;if(b)return a[b];for(d in a)if(!f||!a[d].__standalone)return a[d];return null},remove:function(b){delete a[b.uid]}}}();k.installTo(c.prototype);return c});m("lib/dnd",["base","mediator","runtime/client"],function(g,k,h){function c(a){a=this.options=b.extend({},c.options,a);a.container=b(a.container);a.container.length&&h.call(this,"DragAndDrop")}var b=g.$;c.options={accept:null,disableGlobalDnd:!1};g.inherits(h,{constructor:c,
init:function(){var a=this;a.connectRuntime(a.options,function(){a.exec("init");a.trigger("ready")})}});k.installTo(c.prototype);return c});m("widgets/widget",["base","uploader"],function(g,k){function h(a){if(!a)return!1;var d=a.length,e=b.type(a);return 1===a.nodeType&&d?!0:"array"===e||"function"!==e&&"string"!==e&&(0===d||"number"===typeof d&&0<d&&d-1 in a)}function c(a){this.owner=a;this.options=a.options}var b=g.$,a=k.prototype._init,e=k.prototype.destroy,f={},d=[];b.extend(c.prototype,{init:g.noop,
invoke:function(a,d){var e=this.responseMap;return e&&a in e&&e[a]in this&&b.isFunction(this[e[a]])?this[e[a]].apply(this,d):f},request:function(){return this.owner.request.apply(this.owner,arguments)}});b.extend(k.prototype,{_init:function(){var e=this,f=e._widgets=[],c=e.options.disableWidgets||"";b.each(d,function(a,b){c&&~c.indexOf(b._name)||f.push(new b(e))});return a.apply(e,arguments)},request:function(a,b,d){var e=0,c=this._widgets,q=c&&c.length,p=[],y=[];for(b=h(b)?b:[b];e<q;e++){var n=c[e];
n=n.invoke(a,b);n!==f&&(g.isPromise(n)?y.push(n):p.push(n))}return d||y.length?(a=g.when.apply(g,y),b=a.pipe?"pipe":"then",a[b](function(){var a=g.Deferred(),b=arguments;1===b.length&&(b=b[0]);setTimeout(function(){a.resolve(b)},1);return a.promise()})[d?b:"done"](d||g.noop)):p[0]},destroy:function(){e.apply(this,arguments);this._widgets=null}});k.register=c.register=function(a,e){var f={init:"init",destroy:"destroy",name:"anonymous"};1===arguments.length?(e=a,b.each(e,function(a){"_"===a[0]||"name"===
a?"name"===a&&(f.name=e.name):f[a.replace(/[A-Z]/g,"-$&").toLowerCase()]=a})):f=b.extend(f,a);e.responseMap=f;var q=g.inherits(c,e);q._name=f.name;d.push(q);return q};k.unRegister=c.unRegister=function(a){if(a&&"anonymous"!==a)for(var b=d.length;b--;)d[b]._name===a&&d.splice(b,1)};return c});m("widgets/filednd",["base","uploader","lib/dnd","widgets/widget"],function(g,k,h){var c=g.$;k.options.dnd="";return k.register({name:"dnd",init:function(b){if(b.dnd&&"html5"===this.request("predict-runtime-type")){var a=
this,e=g.Deferred();b=c.extend({},{disableGlobalDnd:b.disableGlobalDnd,container:b.dnd,accept:b.accept});this.dnd=b=new h(b);b.once("ready",e.resolve);b.on("drop",function(b){a.request("add-file",[b])});b.on("accept",function(b){return a.owner.trigger("dndAccept",b)});b.init();return e.promise()}},destroy:function(){this.dnd&&this.dnd.destroy()}})});m("lib/filepaste",["base","mediator","runtime/client"],function(g,k,h){function c(a){a=this.options=b.extend({},a);a.container=b(a.container||document.body);
h.call(this,"FilePaste")}var b=g.$;g.inherits(h,{constructor:c,init:function(){var a=this;a.connectRuntime(a.options,function(){a.exec("init");a.trigger("ready")})}});k.installTo(c.prototype);return c});m("widgets/filepaste",["base","uploader","lib/filepaste","widgets/widget"],function(g,k,h){var c=g.$;return k.register({name:"paste",init:function(b){if(b.paste&&"html5"===this.request("predict-runtime-type")){var a=this,e=g.Deferred();b=c.extend({},{container:b.paste,accept:b.accept});this.paste=
b=new h(b);b.once("ready",e.resolve);b.on("paste",function(b){a.owner.request("add-file",[b])});b.init();return e.promise()}},destroy:function(){this.paste&&this.paste.destroy()}})});m("lib/blob",["base","runtime/client"],function(g,k){function h(c,b){this.source=b;this.ruid=c;this.size=b.size||0;!b.type&&this.ext&&~"jpg,jpeg,png,gif,bmp".indexOf(this.ext)?this.type="image/"+("jpg"===this.ext?"jpeg":this.ext):this.type=b.type||"application/octet-stream";k.call(this,"Blob");this.uid=b.uid||this.uid;
c&&this.connectRuntime(c)}g.inherits(k,{constructor:h,slice:function(c,b){return this.exec("slice",c,b)},getSource:function(){return this.source}});return h});m("lib/file",["base","lib/blob"],function(g,k){function h(a,e){this.name=e.name||"untitled"+c++;var f=b.exec(e.name)?RegExp.$1.toLowerCase():"";!f&&e.type&&(f=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(e.type)?RegExp.$1.toLowerCase():"",this.name+="."+f);this.ext=f;this.lastModifiedDate=e.lastModifiedDate||(new Date).toLocaleString();k.apply(this,arguments)}
var c=1,b=/\.([^.]+)$/;return g.inherits(k,h)});m("lib/filepicker",["base","runtime/client","lib/file"],function(g,k,h){function c(a){a=this.options=b.extend({},c.options,a);a.container=b(a.id);if(!a.container.length)throw Error("\u6309\u94ae\u6307\u5b9a\u9519\u8bef");a.innerHTML=a.innerHTML||a.label||a.container.html()||"";a.button=b(a.button||document.createElement("div"));a.button.html(a.innerHTML);a.container.html(a.button);k.call(this,"FilePicker",!0)}var b=g.$;c.options={button:null,container:null,
label:null,innerHTML:null,multiple:!0,accept:null,name:"file"};g.inherits(k,{constructor:c,init:function(){var a=this,e=a.options,f=e.button;f.addClass("webuploader-pick");a.on("all",function(d){switch(d){case "mouseenter":f.addClass("webuploader-pick-hover");break;case "mouseleave":f.removeClass("webuploader-pick-hover");break;case "change":d=a.exec("getFiles"),a.trigger("select",b.map(d,function(b){b=new h(a.getRuid(),b);b._refer=e.container;return b}),e.container)}});a.connectRuntime(e,function(){a.refresh();
a.exec("init",e);a.trigger("ready")});this._resizeHandler=g.bindFn(this.refresh,this);b(x).on("resize",this._resizeHandler)},refresh:function(){var a=this.getRuntime().getContainer(),b=this.options.button,f=b.outerWidth?b.outerWidth():b.width(),d=b.outerHeight?b.outerHeight():b.height(),c=b.offset();b.is(":visible")||(d=f=1,c={top:-1E3,left:-1E3});f&&d&&a.css({bottom:"auto",right:"auto",width:f+"px",height:d+"px"}).offset(c)},enable:function(){this.options.button.removeClass("webuploader-pick-disable");
this.refresh()},disable:function(){var a=this.options.button;this.getRuntime().getContainer().css({top:"-99999px"});a.addClass("webuploader-pick-disable")},destroy:function(){var a=this.options.button;b(x).off("resize",this._resizeHandler);a.removeClass("webuploader-pick-disable webuploader-pick-hover webuploader-pick")}});return c});m("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(g,k,h){var c=g.$;c.extend(k.options,{pick:null,accept:null});return k.register({name:"picker",
init:function(b){this.pickers=[];return b.pick&&this.addBtn(b.pick)},refresh:function(){c.each(this.pickers,function(){this.refresh()})},addBtn:function(b){var a=this,e=a.options,f=e.accept,d=[];if(b)return c.isPlainObject(b)||(b={id:b}),c(b.id).each(function(){var q=g.Deferred();var p=c.extend({},b,{accept:c.isPlainObject(f)?[f]:f,swf:e.swf,runtimeOrder:e.runtimeOrder,id:this});p=new h(p);p.once("ready",q.resolve);p.on("select",function(b){a.owner.request("add-file",[b])});p.init();a.pickers.push(p);
d.push(q.promise())}),g.when.apply(g,d)},disable:function(){c.each(this.pickers,function(){this.disable()})},enable:function(){c.each(this.pickers,function(){this.enable()})},destroy:function(){c.each(this.pickers,function(){this.destroy()});this.pickers=null}})});m("lib/image",["base","runtime/client","lib/blob"],function(g,k,h){function c(a){this.options=b.extend({},c.options,a);k.call(this,"Image");this.on("load",function(){this._info=this.exec("info");this._meta=this.exec("meta")})}var b=g.$;
c.options={quality:90,crop:!1,preserveHeaders:!1,allowMagnify:!1};g.inherits(k,{constructor:c,info:function(a){return a?(this._info=a,this):this._info},meta:function(a){return a?(this._meta=a,this):this._meta},loadFromBlob:function(a){var b=this,f=a.getRuid();this.connectRuntime(f,function(){b.exec("init",b.options);b.exec("loadFromBlob",a)})},resize:function(){var a=g.slice(arguments);return this.exec.apply(this,["resize"].concat(a))},crop:function(){var a=g.slice(arguments);return this.exec.apply(this,
["crop"].concat(a))},getAsDataUrl:function(a){return this.exec("getAsDataUrl",a)},getAsBlob:function(a){a=this.exec("getAsBlob",a);return new h(this.getRuid(),a)}});return c});m("widgets/image",["base","uploader","lib/image","widgets/widget"],function(g,k,h){var c=g.$;var b=function(a){var b=0,f=[],d=function(){for(var d;f.length&&b<a;)d=f.shift(),b+=d[0],d[1]()};return function(a,e,c){f.push([e,c]);a.once("destroy",function(){b-=e;setTimeout(d,1)});setTimeout(d,1)}}(5242880);c.extend(k.options,{thumb:{width:110,
height:110,quality:70,allowMagnify:!0,crop:!0,preserveHeaders:!1,type:"image/jpeg"},compress:{width:1600,height:1600,quality:90,allowMagnify:!1,crop:!1,preserveHeaders:!0}});return k.register({name:"image",makeThumb:function(a,e,f,d){a=this.request("get-file",a);if(a.type.match(/^image/)){var q=c.extend({},this.options.thumb);c.isPlainObject(f)&&(q=c.extend(q,f),f=null);f=f||q.width;d=d||q.height;var p=new h(q);p.once("load",function(){a._info=a._info||p.info();a._meta=a._meta||p.meta();1>=f&&0<f&&
(f*=a._info.width);1>=d&&0<d&&(d*=a._info.height);p.resize(f,d)});p.once("complete",function(){e(!1,p.getAsDataUrl(q.type));p.destroy()});p.once("error",function(a){e(a||!0);p.destroy()});b(p,a.source.size,function(){a._info&&p.info(a._info);a._meta&&p.meta(a._meta);p.loadFromBlob(a.source)})}else e(!0)},beforeSendFile:function(a){var b=this.options.compress||this.options.resize,f=b&&b.compressSize||0,d=b&&b.noCompressIfLarger||!1;a=this.request("get-file",a);if(b&&~"image/jpeg,image/jpg".indexOf(a.type)&&
!(a.size<f)&&!a._compressed){b=c.extend({},b);var q=g.Deferred();var p=new h(b);q.always(function(){p.destroy();p=null});p.once("error",q.reject);p.once("load",function(){var d=b.width,e=b.height;a._info=a._info||p.info();a._meta=a._meta||p.meta();1>=d&&0<d&&(d*=a._info.width);1>=e&&0<e&&(e*=a._info.height);p.resize(d,e)});p.once("complete",function(){try{var e=p.getAsBlob(b.type);var f=a.size;if(!d||e.size<f)a.source=e,a.size=e.size,a.trigger("resize",e.size,f);a._compressed=!0;q.resolve()}catch(l){q.resolve()}});
a._info&&p.info(a._info);a._meta&&p.meta(a._meta);p.loadFromBlob(a.source);return q.promise()}}})});m("file",["base","mediator"],function(g,k){function h(e){this.name=e.name||"Untitled";this.size=e.size||0;this.type=e.type||"application/octet-stream";this.lastModifiedDate=e.lastModifiedDate||1*new Date;this.id="WU_FILE_"+c++;this.ext=b.exec(this.name)?RegExp.$1:"";this.statusText="";a[this.id]=h.Status.INITED;this.source=e;this.loaded=0;this.on("error",function(a){this.setStatus(h.Status.ERROR,a)})}
var c=0,b=/\.([^.]+)$/,a={};g.$.extend(h.prototype,{setStatus:function(b,f){var d=a[this.id];"undefined"!==typeof f&&(this.statusText=f);b!==d&&(a[this.id]=b,this.trigger("statuschange",b,d))},getStatus:function(){return a[this.id]},getSource:function(){return this.source},destroy:function(){this.off();delete a[this.id]}});k.installTo(h.prototype);h.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"};
return h});m("queue",["base","mediator","file"],function(g,k,h){function c(){this.stats={numOfQueue:0,numOfSuccess:0,numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0,numofDeleted:0,numofInterrupt:0};this._queue=[];this._map={}}var b=g.$,a=h.Status;b.extend(c.prototype,{append:function(a){this._queue.push(a);this._fileAdded(a);return this},prepend:function(a){this._queue.unshift(a);this._fileAdded(a);return this},getFile:function(a){return"string"!==typeof a?a:this._map[a]},fetch:function(b){var e=
this._queue.length,d;b=b||a.QUEUED;for(d=0;d<e;d++){var c=this._queue[d];if(b===c.getStatus())return c}return null},sort:function(a){"function"===typeof a&&this._queue.sort(a)},getFiles:function(){for(var a=[].slice.call(arguments,0),f=[],d=0,c=this._queue.length,p;d<c;d++)p=this._queue[d],a.length&&!~b.inArray(p.getStatus(),a)||f.push(p);return f},removeFile:function(a){this._map[a.id]&&(delete this._map[a.id],a.destroy(),this.stats.numofDeleted++)},_fileAdded:function(a){var b=this;this._map[a.id]||
(this._map[a.id]=a,a.on("statuschange",function(a,e){b._onFileStatusChange(a,e)}))},_onFileStatusChange:function(b,c){var d=this.stats;switch(c){case a.PROGRESS:d.numOfProgress--;break;case a.QUEUED:d.numOfQueue--;break;case a.ERROR:d.numOfUploadFailed--;break;case a.INVALID:d.numOfInvalid--;break;case a.INTERRUPT:d.numofInterrupt--}switch(b){case a.QUEUED:d.numOfQueue++;break;case a.PROGRESS:d.numOfProgress++;break;case a.ERROR:d.numOfUploadFailed++;break;case a.COMPLETE:d.numOfSuccess++;break;case a.CANCELLED:d.numOfCancel++;
break;case a.INVALID:d.numOfInvalid++;break;case a.INTERRUPT:d.numofInterrupt++}}});k.installTo(c.prototype);return c});m("widgets/queue","base uploader queue file lib/file runtime/client widgets/widget".split(" "),function(g,k,h,c,b,a){var e=g.$,f=/\.\w+$/,d=c.Status;return k.register({name:"queue",init:function(b){var d=this,c,f,q,t;e.isPlainObject(b.accept)&&(b.accept=[b.accept]);if(b.accept){var v=[];var y=0;for(c=b.accept.length;y<c;y++)(f=b.accept[y].extensions)&&v.push(f);v.length&&(q="\\."+
v.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$");d.accept=new RegExp(q,"i")}d.queue=new h;d.stats=d.queue.stats;if("html5"===this.request("predict-runtime-type")){var n=g.Deferred();this.placeholder=t=new a("Placeholder");t.connectRuntime({runtimeOrder:"html5"},function(){d._ruid=t.getRuid();n.resolve()});return n.promise()}},_wrapFile:function(a){if(!(a instanceof c)){if(!(a instanceof b)){if(!this._ruid)throw Error("Can't add external files.");a=new b(this._ruid,a)}a=new c(a)}return a},
acceptFile:function(a){return!(!a||!a.size||this.accept&&f.exec(a.name)&&!this.accept.test(a.name))},_addFile:function(a){a=this._wrapFile(a);if(this.owner.trigger("beforeFileQueued",a))if(a&&a.size){if(this.acceptFile(a))return this.queue.append(a),this.owner.trigger("fileQueued",a),a;this.owner.trigger("error","Q_TYPE_DENIED",a)}else this.owner.trigger("error","Q_EMPTY_FILE",a)},getFile:function(a){return this.queue.getFile(a)},addFile:function(a){var b=this;a.length||(a=[a]);a=e.map(a,function(a){return b._addFile(a)});
b.owner.trigger("filesQueued",a);b.options.auto&&setTimeout(function(){b.request("start-upload")},20)},getStats:function(){return this.stats},removeFile:function(a,b){a=a.id?a:this.queue.getFile(a);this.request("cancel-file",a);b&&this.queue.removeFile(a)},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,arguments)},retry:function(a,b){var e;if(a)a=a.id?a:this.queue.getFile(a),a.setStatus(d.QUEUED),b||this.request("start-upload");
else{b=this.queue.getFiles(d.ERROR);var c=0;for(e=b.length;c<e;c++)a=b[c],a.setStatus(d.QUEUED);this.request("start-upload")}},sortFiles:function(){return this.queue.sort.apply(this.queue,arguments)},reset:function(){this.owner.trigger("reset");this.queue=new h;this.stats=this.queue.stats},destroy:function(){this.reset();this.placeholder&&this.placeholder.destroy()}})});m("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(g,k){g.support=function(){return k.hasRuntime.apply(k,
arguments)};return g.register({name:"runtime",init:function(){if(!this.predictRuntimeType())throw Error("Runtime Error");},predictRuntimeType:function(){var h=this.options.runtimeOrder||k.orders,c=this.type,b;if(!c){h=h.split(/\s*,\s*/g);var a=0;for(b=h.length;a<b;a++)if(k.hasRuntime(h[a])){this.type=c=h[a];break}}return c}})});m("lib/transport",["base","runtime/client","mediator"],function(g,k,h){function c(a){var e=this;a=e.options=b.extend(!0,{},c.options,a||{});k.call(this,"Transport");this._blob=
null;this._formData=a.formData||{};this._headers=a.headers||{};this.on("progress",this._timeout);this.on("load error",function(){e.trigger("progress",1);clearTimeout(e._timer)})}var b=g.$;c.options={server:"",method:"POST",withCredentials:!0,fileVal:"file",timeout:12E4,formData:{},headers:{},sendAsBinary:!1};b.extend(c.prototype,{appendBlob:function(a,b,c){var d=this,e=d.options;d.getRuid()&&d.disconnectRuntime();d.connectRuntime(b.ruid,function(){d.exec("init")});d._blob=b;e.fileVal=a||e.fileVal;
e.filename=c||e.filename},append:function(a,e){"object"===typeof a?b.extend(this._formData,a):this._formData[a]=e},setRequestHeader:function(a,e){"object"===typeof a?b.extend(this._headers,a):this._headers[a]=e},send:function(a){this.exec("send",a);this._timeout()},abort:function(){clearTimeout(this._timer);return this.exec("abort")},destroy:function(){this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},getResponseAsJson:function(){return this.exec("getResponseAsJson")},
getStatus:function(){return this.exec("getStatus")},_timeout:function(){var a=this,b=a.options.timeout;b&&(clearTimeout(a._timer),a._timer=setTimeout(function(){a.abort();a.trigger("error","timeout")},b))}});h.installTo(c.prototype);return c});m("widgets/upload",["base","uploader","file","lib/transport","widgets/widget"],function(g,k,h,c){function b(a,b){var d=[],e=a.source.size,c=b?Math.ceil(e/b):1,f=0,q=0,h;for(h={file:a,has:function(){return!!d.length},shift:function(){return d.shift()},unshift:function(a){d.unshift(a)}};q<
c;){var g=Math.min(b,e-f);d.push({file:a,start:f,end:b?f+g:e,total:e,chunks:c,chunk:q++,cuted:h});f+=g}a.blocks=d.concat();a.remaning=d.length;return h}var a=g.$,e=g.isPromise,f=h.Status;a.extend(k.options,{prepareNextFile:!1,chunked:!1,chunkSize:5242880,chunkRetry:2,threads:3,formData:{}});k.register({name:"upload",init:function(){var b=this.owner,e=this;this.progress=this.runing=!1;b.on("startUpload",function(){e.progress=!0}).on("uploadFinished",function(){e.progress=!1});this.pool=[];this.stack=
[];this.pending=[];this.remaning=0;this.__tick=g.bindFn(this._tick,this);b.on("uploadComplete",function(b){b.blocks&&a.each(b.blocks,function(a,b){b.transport&&(b.transport.abort(),b.transport.destroy());delete b.transport});delete b.blocks;delete b.remaning})},reset:function(){this.request("stop-upload",!0);this.runing=!1;this.pool=[];this.stack=[];this.pending=[];this.remaning=0;this._trigged=!1;this._promise=null},startUpload:function(b){var d=this;a.each(d.request("get-files",f.INVALID),function(){d.request("remove-file",
this)});if(b){b=b.id?b:d.request("get-file",b);if(b.getStatus()===f.INTERRUPT)a.each(d.pool,function(a,d){d.file===b&&d.transport&&d.transport.send()});else if(b.getStatus()===f.PROGRESS)return;b.setStatus(f.QUEUED)}else a.each(d.request("get-files",[f.INITED]),function(){this.setStatus(f.QUEUED)});if(!d.runing){d.runing=!0;var e=[];for(a.each(d.pool,function(a,b){a=b.file;a.getStatus()===f.INTERRUPT&&(e.push(a),d._trigged=!1,b.transport&&b.transport.send())});b=e.shift();)b.setStatus(f.PROGRESS);
b||a.each(d.request("get-files",f.INTERRUPT),function(){this.setStatus(f.PROGRESS)});d._trigged=!1;g.nextTick(d.__tick);d.owner.trigger("startUpload")}},stopUpload:function(b,e){var d=this;!0===b&&(e=b,b=null);if(!1!==d.runing){if(b){b=b.id?b:d.request("get-file",b);if(b.getStatus()!==f.PROGRESS&&b.getStatus()!==f.QUEUED)return;b.setStatus(f.INTERRUPT);a.each(d.pool,function(a,e){e.file===b&&(e.transport&&e.transport.abort(),d._putback(e),d._popBlock(e))});return g.nextTick(d.__tick)}d.runing=!1;
this._promise&&this._promise.file&&this._promise.file.setStatus(f.INTERRUPT);e&&a.each(d.pool,function(a,b){b.transport&&b.transport.abort();b.file.setStatus(f.INTERRUPT)});d.owner.trigger("stopUpload")}},cancelFile:function(b){b=b.id?b:this.request("get-file",b);b.blocks&&a.each(b.blocks,function(a,b){if(a=b.transport)a.abort(),a.destroy(),delete b.transport});b.setStatus(f.CANCELLED);this.owner.trigger("fileDequeued",b)},isInProgress:function(){return!!this.progress},_getStats:function(){return this.request("get-stats")},
skipFile:function(b,e){b=b.id?b:this.request("get-file",b);b.setStatus(e||f.COMPLETE);b.skipped=!0;b.blocks&&a.each(b.blocks,function(a,b){if(a=b.transport)a.abort(),a.destroy(),delete b.transport});this.owner.trigger("uploadSkip",b)},_tick:function(){var a=this,b=a.options,c;if(a._promise)return a._promise.always(a.__tick);a.pool.length<b.threads&&(c=a._nextBlock())?(a._trigged=!1,b=function(b){a._promise=null;b&&b.file&&a._startSend(b);g.nextTick(a.__tick)},a._promise=e(c)?c.always(b):b(c)):a.remaning||
a._getStats().numOfQueue||a._getStats().numofInterrupt||(a.runing=!1,a._trigged||g.nextTick(function(){a.owner.trigger("uploadFinished")}),a._trigged=!0)},_putback:function(a){a.cuted.unshift(a);~this.stack.indexOf(a.cuted)||this.stack.unshift(a.cuted)},_getStack:function(){for(var a=0,b;b=this.stack[a++];){if(b.has()&&b.file.getStatus()===f.PROGRESS)return b;(!b.has()||b.file.getStatus()!==f.PROGRESS&&b.file.getStatus()!==f.INTERRUPT)&&this.stack.splice(--a,1)}return null},_nextBlock:function(){var a=
this,c=a.options,f;if(f=this._getStack())return c.prepareNextFile&&!a.pending.length&&a._prepareNextFile(),f.shift();if(a.runing){!a.pending.length&&a._getStats().numOfQueue&&a._prepareNextFile();var h=a.pending.shift();var g=function(d){if(!d)return null;f=b(d,c.chunked?c.chunkSize:0);a.stack.push(f);return f.shift()};if(e(h)){var l=h.file;h=h[h.pipe?"pipe":"then"](g);h.file=l;return h}return g(h)}},_prepareNextFile:function(){var b=this,e=b.request("fetch-file"),c=b.pending;if(e){var h=b.request("before-send-file",
e,function(){return e.getStatus()===f.PROGRESS||e.getStatus()===f.INTERRUPT?e:b._finishFile(e)});b.owner.trigger("uploadStart",e);e.setStatus(f.PROGRESS);h.file=e;h.done(function(){var b=a.inArray(h,c);~b&&c.splice(b,1,e)});h.fail(function(a){e.setStatus(f.ERROR,a);b.owner.trigger("uploadError",e,a);b.owner.trigger("uploadComplete",e)});c.push(h)}},_popBlock:function(b){var e=a.inArray(b,this.pool);this.pool.splice(e,1);b.file.remaning--;this.remaning--},_startSend:function(a){var b=this,e=a.file;
e.getStatus()!==f.PROGRESS?e.getStatus()===f.INTERRUPT&&b._putback(a):(b.pool.push(a),b.remaning++,a.blob=1===a.chunks?e.source:e.source.slice(a.start,a.end),b.request("before-send",a,function(){e.getStatus()===f.PROGRESS?b._doSend(a):(b._popBlock(a),g.nextTick(b.__tick))}).fail(function(){1===e.remaning?b._finishFile(e).always(function(){a.percentage=1;b._popBlock(a);b.owner.trigger("uploadComplete",e);g.nextTick(b.__tick)}):(a.percentage=1,b.updateFileProgress(e),b._popBlock(a),g.nextTick(b.__tick))}))},
_doSend:function(b){var e=this,d=e.owner,h=e.options,k=b.file,l=new c(h),t=a.extend({},h.formData),v=a.extend({},h.headers),y;b.transport=l;l.on("destroy",function(){delete b.transport;e._popBlock(b);g.nextTick(e.__tick)});l.on("progress",function(a){b.percentage=a;e.updateFileProgress(k)});var n=function(a){y=l.getResponseAsJson()||{};y._raw=l.getResponse();d.trigger("uploadAccept",b,y,function(b){a=b})||(a=a||"server");return a};l.on("error",function(a,e){b.retried=b.retried||0;1<b.chunks&&~"http,abort".indexOf(a)&&
b.retried<h.chunkRetry?(b.retried++,l.send()):(e||"server"!==a||(a=n(a)),k.setStatus(f.ERROR,a),d.trigger("uploadError",k,a),d.trigger("uploadComplete",k))});l.on("load",function(){var a;(a=n())?l.trigger("error",a,!0):1===k.remaning?e._finishFile(k,y):l.destroy()});t=a.extend(t,{id:k.id,name:k.name,type:k.type,lastModifiedDate:k.lastModifiedDate,size:k.size});1<b.chunks&&a.extend(t,{chunks:b.chunks,chunk:b.chunk});d.trigger("uploadBeforeSend",b,t,v);l.appendBlob(h.fileVal,b.blob,k.name);l.append(t);
l.setRequestHeader(v);l.send()},_finishFile:function(a,b,e){var c=this.owner;return c.request("after-send-file",arguments,function(){a.setStatus(f.COMPLETE);c.trigger("uploadSuccess",a,b,e)}).fail(function(b){a.getStatus()===f.PROGRESS&&a.setStatus(f.ERROR,b);c.trigger("uploadError",a,b)}).always(function(){c.trigger("uploadComplete",a)})},updateFileProgress:function(b){var e=0,c=0;b.blocks&&(a.each(b.blocks,function(a,b){c+=(b.percentage||0)*(b.end-b.start)}),e=c/b.size,this.owner.trigger("uploadProgress",
b,e||0))}})});m("widgets/validator",["base","uploader","file","widgets/widget"],function(g,k,h){var c=g.$,b={};var a={addValidator:function(a,c){b[a]=c},removeValidator:function(a){delete b[a]}};k.register({name:"validator",init:function(){var a=this;g.nextTick(function(){c.each(b,function(){this.call(a.owner)})})}});a.addValidator("fileNumLimit",function(){var a=0,b=parseInt(this.options.fileNumLimit,10),c=!0;b&&(this.on("beforeFileQueued",function(e){a>=b&&c&&(c=!1,this.trigger("error","Q_EXCEED_NUM_LIMIT",
b,e),setTimeout(function(){c=!0},1));return a>=b?!1:!0}),this.on("fileQueued",function(){a++}),this.on("fileDequeued",function(){a--}),this.on("reset",function(){a=0}))});a.addValidator("fileSizeLimit",function(){var a=0,b=parseInt(this.options.fileSizeLimit,10),c=!0;b&&(this.on("beforeFileQueued",function(e){var d=a+e.size>b;d&&c&&(c=!1,this.trigger("error","Q_EXCEED_SIZE_LIMIT",b,e),setTimeout(function(){c=!0},1));return d?!1:!0}),this.on("fileQueued",function(b){a+=b.size}),this.on("fileDequeued",
function(b){a-=b.size}),this.on("reset",function(){a=0}))});a.addValidator("fileSingleSizeLimit",function(){var a=this.options.fileSingleSizeLimit;if(a)this.on("beforeFileQueued",function(b){if(b.size>a)return b.setStatus(h.Status.INVALID,"exceed_size"),this.trigger("error","F_EXCEED_SIZE",a,b),!1})});a.addValidator("duplicate",function(){var a={};this.options.duplicate||(this.on("beforeFileQueued",function(b){var e;if(!(e=b.__hash)){e=b.name+b.size+b.lastModifiedDate;for(var c=0,f=0,h=e.length,g;f<
h;f++)g=e.charCodeAt(f),c=g+(c<<6)+(c<<16)-c;e=b.__hash=c}if(a[e])return this.trigger("error","F_DUPLICATE",b),!1}),this.on("fileQueued",function(b){(b=b.__hash)&&(a[b]=!0)}),this.on("fileDequeued",function(b){(b=b.__hash)&&delete a[b]}),this.on("reset",function(){a={}}))});return a});m("lib/md5",["runtime/client","mediator"],function(g,k){function h(){g.call(this,"Md5")}k.installTo(h.prototype);h.prototype.loadFromBlob=function(c){var b=this;b.getRuid()&&b.disconnectRuntime();b.connectRuntime(c.ruid,
function(){b.exec("init");b.exec("loadFromBlob",c)})};h.prototype.getResult=function(){return this.exec("getResult")};return h});m("widgets/md5",["base","uploader","lib/md5","lib/blob","widgets/widget"],function(g,k,h,c){return k.register({name:"md5",md5File:function(b,a,e){var f=new h,d=g.Deferred(),k=b instanceof c?b:this.request("get-file",b).source;f.on("progress load",function(a){a=a||{};d.notify(a.total?a.loaded/a.total:1)});f.on("complete",function(){d.resolve(f.getResult())});f.on("error",
function(a){d.reject(a)});1<arguments.length&&(a=a||0,e=e||0,0>a&&(a=k.size+a),0>e&&(e=k.size+e),e=Math.min(e,k.size),k=k.slice(a,e));f.loadFromBlob(k);return d.promise()}})});m("runtime/compbase",[],function(){return function(g,k){this.owner=g;this.options=g.options;this.getRuntime=function(){return k};this.getRuid=function(){return k.uid};this.trigger=function(){return g.trigger.apply(g,arguments)}}});m("runtime/html5/runtime",["base","runtime/runtime","runtime/compbase"],function(g,k,h){function c(){var a=
{},e=this,c=this.destroy;k.apply(e,arguments);e.type="html5";e.exec=function(c,f){var d=this.uid,h=g.slice(arguments,2);if(b[c]&&(d=a[d]=a[d]||new b[c](this,e),d[f]))return d[f].apply(d,h)};e.destroy=function(){return c&&c.apply(this,arguments)}}var b={};g.inherits(k,{constructor:c,init:function(){var a=this;setTimeout(function(){a.trigger("ready")},1)}});c.register=function(a,e){return b[a]=g.inherits(h,e)};x.Blob&&x.FileReader&&x.DataView&&k.addRuntime("html5",c);return c});m("runtime/html5/blob",
["runtime/html5/runtime","lib/blob"],function(g,k){return g.register("Blob",{slice:function(h,c){var b=this.owner.source;b=(b.slice||b.webkitSlice||b.mozSlice).call(b,h,c);return new k(this.getRuid(),b)}})});m("runtime/html5/dnd",["base","runtime/html5/runtime","lib/file"],function(g,k,h){var c=g.$;return k.register("DragAndDrop",{init:function(){var b=this.elem=this.options.container;this.dragEnterHandler=g.bindFn(this._dragEnterHandler,this);this.dragOverHandler=g.bindFn(this._dragOverHandler,this);
this.dragLeaveHandler=g.bindFn(this._dragLeaveHandler,this);this.dropHandler=g.bindFn(this._dropHandler,this);this.dndOver=!1;b.on("dragenter",this.dragEnterHandler);b.on("dragover",this.dragOverHandler);b.on("dragleave",this.dragLeaveHandler);b.on("drop",this.dropHandler);this.options.disableGlobalDnd&&(c(document).on("dragover",this.dragOverHandler),c(document).on("drop",this.dropHandler))},_dragEnterHandler:function(b){var a=this._denied||!1,e;b=b.originalEvent||b;this.dndOver||(this.dndOver=!0,
(e=b.dataTransfer.items)&&e.length&&(this._denied=a=!this.trigger("accept",e)),this.elem.addClass("webuploader-dnd-over"),this.elem[a?"addClass":"removeClass"]("webuploader-dnd-denied"));b.dataTransfer.dropEffect=a?"none":"copy";return!1},_dragOverHandler:function(b){var a=this.elem.parent().get(0);if(a&&!c.contains(a,b.currentTarget))return!1;clearTimeout(this._leaveTimer);this._dragEnterHandler.call(this,b);return!1},_dragLeaveHandler:function(){var b=this;clearTimeout(b._leaveTimer);b._leaveTimer=
setTimeout(function(){b.dndOver=!1;b.elem.removeClass("webuploader-dnd-over webuploader-dnd-denied")},100);return!1},_dropHandler:function(b){var a=this,e=a.getRuid(),f=a.elem.parent().get(0);if(f&&!c.contains(f,b.currentTarget))return!1;b=b.originalEvent||b;b=b.dataTransfer;try{var d=b.getData("text/html")}catch(q){}if(!d)return a._getTansferFiles(b,function(b){a.trigger("drop",c.map(b,function(a){return new h(e,a)}))}),a.dndOver=!1,a.elem.removeClass("webuploader-dnd-over"),!1},_getTansferFiles:function(b,
a){var e=[],c=[],d;var h=b.items;b=b.files;var k=!(!h||!h[0].webkitGetAsEntry);var m=0;for(d=b.length;m<d;m++){var r=b[m];var l=h&&h[m];k&&l.webkitGetAsEntry().isDirectory?c.push(this._traverseDirectoryTree(l.webkitGetAsEntry(),e)):e.push(r)}g.when.apply(g,c).done(function(){e.length&&a(e)})},_traverseDirectoryTree:function(b,a){var e=g.Deferred(),c=this;b.isFile?b.file(function(b){a.push(b);e.resolve()}):b.isDirectory&&b.createReader().readEntries(function(b){var d=b.length,f=[],h=[],k;for(k=0;k<
d;k++)f.push(c._traverseDirectoryTree(b[k],h));g.when.apply(g,f).then(function(){a.push.apply(a,h);e.resolve()},e.reject)});return e.promise()},destroy:function(){var b=this.elem;b&&(b.off("dragenter",this.dragEnterHandler),b.off("dragover",this.dragOverHandler),b.off("dragleave",this.dragLeaveHandler),b.off("drop",this.dropHandler),this.options.disableGlobalDnd&&(c(document).off("dragover",this.dragOverHandler),c(document).off("drop",this.dropHandler)))}})});m("runtime/html5/filepaste",["base","runtime/html5/runtime",
"lib/file"],function(g,k,h){return k.register("FilePaste",{init:function(){var c=this.options,b=this.elem=c.container,a=".*",e,f;if(c.accept){var d=[];var h=0;for(e=c.accept.length;h<e;h++)(f=c.accept[h].mimeTypes)&&d.push(f);d.length&&(a=d.join(","),a=a.replace(/,/g,"|").replace(/\*/g,".*"))}this.accept=new RegExp(a,"i");this.hander=g.bindFn(this._pasteHander,this);b.on("paste",this.hander)},_pasteHander:function(c){var b=[],a=this.getRuid(),e,f;c=c.originalEvent||c;var d=c.clipboardData.items;var g=
0;for(f=d.length;g<f;g++){var k=d[g];"file"===k.kind&&(e=k.getAsFile())&&b.push(new h(a,e))}b.length&&(c.preventDefault(),c.stopPropagation(),this.trigger("paste",b))},destroy:function(){this.elem.off("paste",this.hander)}})});m("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(g,k){var h=g.$;return k.register("FilePicker",{init:function(){var c=this.getRuntime().getContainer(),b=this,a=b.owner,e=b.options,f=this.label=h(document.createElement("label")),d=this.input=h(document.createElement("input")),
g;d.attr("type","file");d.attr("name",e.name);d.addClass("webuploader-element-invisible");f.on("click",function(){d.trigger("click")});f.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"});e.multiple&&d.attr("multiple","multiple");if(e.accept&&0<e.accept.length){var k=[];var m=0;for(g=e.accept.length;m<g;m++)k.push(e.accept[m].mimeTypes);d.attr("accept",k.join(","))}c.append(d);c.append(f);var r=function(b){a.trigger(b.type)};d.on("change",function(e){var c=
arguments.callee;b.files=e.target.files;var f=this.cloneNode(!0);f.value=null;this.parentNode.replaceChild(f,this);d.off();d=h(f).on("change",c).on("mouseenter mouseleave",r);a.trigger("change")});f.on("mouseenter mouseleave",r)},getFiles:function(){return this.files},destroy:function(){this.input.off();this.label.off()}})});m("runtime/html5/util",["base"],function(g){var k=x.createObjectURL&&x||x.URL&&URL.revokeObjectURL&&URL||x.webkitURL,h=g=g.noop;k&&(g=function(){return k.createObjectURL.apply(k,
arguments)},h=function(){return k.revokeObjectURL.apply(k,arguments)});return{createObjectURL:g,revokeObjectURL:h,dataURL2Blob:function(c){var b;var a=c.split(",");var e=~a[0].indexOf("base64")?atob(a[1]):decodeURIComponent(a[1]);c=new ArrayBuffer(e.length);var f=new Uint8Array(c);for(b=0;b<e.length;b++)f[b]=e.charCodeAt(b);e=a[0].split(":")[1].split(";")[0];return this.arrayBufferToBlob(c,e)},dataURL2ArrayBuffer:function(c){var b;c=c.split(",");c=~c[0].indexOf("base64")?atob(c[1]):decodeURIComponent(c[1]);
var a=new Uint8Array(c.length);for(b=0;b<c.length;b++)a[b]=c.charCodeAt(b);return a.buffer},arrayBufferToBlob:function(c,b){var a=x.BlobBuilder||x.WebKitBlobBuilder;return a?(a=new a,a.append(c),a.getBlob(b)):new Blob([c],b?{type:b}:{})},canvasToDataUrl:function(c,b,a){return c.toDataURL(b,a/100)},parseMeta:function(c,b){b(!1,{})},updateImageHead:function(c){return c}}});m("runtime/html5/imagemeta",["runtime/html5/util"],function(g){var k={parsers:{65505:[]},maxMetaDataSize:262144,parse:function(h,
c){var b=this,a=new FileReader;a.onload=function(){c(!1,b._parse(this.result));a=a.onload=a.onerror=null};a.onerror=function(b){c(b.message);a=a.onload=a.onerror=null};h=h.slice(0,b.maxMetaDataSize);a.readAsArrayBuffer(h.getSource())},_parse:function(h,c){if(!(6>h.byteLength)){var b=new DataView(h),a=2,e=b.byteLength-4,f=a,d={};if(65496===b.getUint16(0)){for(;a<e;){var g=b.getUint16(a);if(65504<=g&&65519>=g||65534===g){var p=b.getUint16(a+2)+2;if(a+p>b.byteLength)break;f=k.parsers[g];if(!c&&f)for(g=
0;g<f.length;g+=1)f[g].call(k,b,a,p,d);f=a+=p}else break}6<f&&(d.imageHead=h.slice?h.slice(2,f):(new Uint8Array(h)).subarray(2,f))}return d}},updateImageHead:function(h,c){var b=this._parse(h,!0);var a=2;b.imageHead&&(a=2+b.imageHead.byteLength);b=h.slice?h.slice(a):(new Uint8Array(h)).subarray(a);h=new Uint8Array(c.byteLength+2+b.byteLength);h[0]=255;h[1]=216;h.set(new Uint8Array(c),2);h.set(new Uint8Array(b),c.byteLength+2);return h.buffer}};g.parseMeta=function(){return k.parse.apply(k,arguments)};
g.updateImageHead=function(){return k.updateImageHead.apply(k,arguments)};return k});m("runtime/html5/imagemeta/exif",["base","runtime/html5/imagemeta"],function(g,k){var h={ExifMap:function(){return this}};h.ExifMap.prototype.map={Orientation:274};h.ExifMap.prototype.get=function(c){return this[c]||this[this.map[c]]};h.exifTagTypes={1:{getValue:function(c,b){return c.getUint8(b)},size:1},2:{getValue:function(c,b){return String.fromCharCode(c.getUint8(b))},size:1,ascii:!0},3:{getValue:function(c,
b,a){return c.getUint16(b,a)},size:2},4:{getValue:function(c,b,a){return c.getUint32(b,a)},size:4},5:{getValue:function(c,b,a){return c.getUint32(b,a)/c.getUint32(b+4,a)},size:8},9:{getValue:function(c,b,a){return c.getInt32(b,a)},size:4},10:{getValue:function(c,b,a){return c.getInt32(b,a)/c.getInt32(b+4,a)},size:8}};h.exifTagTypes[7]=h.exifTagTypes[1];h.getExifValue=function(c,b,a,e,f,d){e=h.exifTagTypes[e];if(e){var k=e.size*f;var p=4<k?b+c.getUint32(a+8,d):a+8;if(p+k>c.byteLength)g.log("Invalid Exif data: Invalid data offset.");
else{if(1===f)return e.getValue(c,p,d);b=[];for(a=0;a<f;a+=1)b[a]=e.getValue(c,p+a*e.size,d);if(e.ascii){c="";for(a=0;a<b.length;a+=1){f=b[a];if("\x00"===f)break;c+=f}return c}return b}}else g.log("Invalid Exif data: Invalid tag type.")};h.parseExifTag=function(c,b,a,e,f){var d=c.getUint16(a,e);f.exif[d]=h.getExifValue(c,b,a,c.getUint16(a+2,e),c.getUint32(a+4,e),e)};h.parseExifTags=function(c,b,a,e,f){var d;if(a+6>c.byteLength)g.log("Invalid Exif data: Invalid directory offset.");else{var h=c.getUint16(a,
e);var k=a+2+12*h;if(k+4>c.byteLength)g.log("Invalid Exif data: Invalid directory size.");else{for(d=0;d<h;d+=1)this.parseExifTag(c,b,a+2+12*d,e,f);return c.getUint32(k,e)}}};h.parseExifData=function(c,b,a,e){a=b+10;if(1165519206===c.getUint32(b+4))if(a+8>c.byteLength)g.log("Invalid Exif data: Invalid segment size.");else if(0!==c.getUint16(b+8))g.log("Invalid Exif data: Missing byte alignment offset.");else{switch(c.getUint16(a)){case 18761:b=!0;break;case 19789:b=!1;break;default:g.log("Invalid Exif data: Invalid byte alignment marker.");
return}if(42!==c.getUint16(a+2,b))g.log("Invalid Exif data: Missing TIFF marker.");else{var f=c.getUint32(a+4,b);e.exif=new h.ExifMap;h.parseExifTags(c,a,a+f,b,e)}}};k.parsers[65505].push(h.parseExifData);return h});m("runtime/html5/jpegencoder",[],function(g,k,h){function c(b){function a(a,b){for(var c=0,e=0,d=[],f=1;16>=f;f++){for(var h=1;h<=a[f];h++)d[b[e]]=[],d[b[e]][0]=c,d[b[e]][1]=f,e++,c++;c*=2}return d}function e(a){var b=a[0];for(a=a[1]-1;0<=a;)b&1<<a&&(E|=1<<C),a--,C--,0>C&&(255==E?(c(255),
c(0)):c(E),C=7,E=0)}function c(a){B.push(G[a])}function d(a){c(a>>8&255);c(a&255)}function h(a,b,c,d,f){var h=f[0],g=f[240],t,k=0;for(t=0;8>t;++t){var v=a[k];var l=a[k+1];var p=a[k+2];var q=a[k+3];var m=a[k+4];var w=a[k+5];var A=a[k+6];var r=a[k+7];var u=v+r;v-=r;r=l+A;l-=A;A=p+w;p-=w;w=q+m;q-=m;m=u+w;u-=w;w=r+A;r-=A;a[k]=m+w;a[k+4]=m-w;m=.707106781*(r+u);a[k+2]=u+m;a[k+6]=u-m;m=q+p;w=p+l;r=l+v;p=.382683433*(m-r);q=.5411961*m+p;m=1.306562965*r+p;w*=.707106781;p=v+w;v-=w;a[k+5]=v+q;a[k+3]=v-q;a[k+
1]=p+m;a[k+7]=p-m;k+=8}for(t=k=0;8>t;++t)v=a[k],l=a[k+8],p=a[k+16],q=a[k+24],m=a[k+32],w=a[k+40],A=a[k+48],r=a[k+56],u=v+r,v-=r,r=l+A,l-=A,A=p+w,p-=w,w=q+m,q-=m,m=u+w,u-=w,w=r+A,r-=A,a[k]=m+w,a[k+32]=m-w,m=.707106781*(r+u),a[k+16]=u+m,a[k+48]=u-m,m=q+p,w=p+l,r=l+v,p=.382683433*(m-r),q=.5411961*m+p,m=1.306562965*r+p,w*=.707106781,p=v+w,v-=w,a[k+40]=v+q,a[k+24]=v-q,a[k+8]=p+m,a[k+56]=p-m,k++;for(t=0;64>t;++t)k=a[t]*b[t],D[t]=0<k?k+.5|0:k-.5|0;a=D;for(b=0;64>b;++b)x[F[b]]=a[b];a=x[0]-c;c=x[0];0==a?e(d[0]):
(t=32767+a,e(d[n[t]]),e(y[t]));for(d=63;0<d&&0==x[d];d--);if(0==d)return e(h),c;for(a=1;a<=d;){for(b=a;0==x[a]&&a<=d;++a);b=a-b;if(16<=b){t=b>>4;for(k=1;k<=t;++k)e(g);b&=15}t=32767+x[a];e(f[(b<<4)+n[t]]);e(y[t]);a++}63!=d&&e(h);return c}function g(a){0>=a&&(a=1);100<a&&(a=100);if(H!=a){for(var b=50>a?Math.floor(5E3/a):Math.floor(200-2*a),c=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,
103,121,120,101,72,92,95,98,112,100,103,99],e=0;64>e;e++){var d=k((c[e]*b+50)/100);1>d?d=1:255<d&&(d=255);m[F[e]]=d}c=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99];for(e=0;64>e;e++)d=k((c[e]*b+50)/100),1>d?d=1:255<d&&(d=255),l[F[e]]=d;b=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379];for(e=c=0;8>e;e++)for(d=0;8>d;d++)t[c]=1/(m[F[c]]*
b[e]*b[d]*8),v[c]=1/(l[F[c]]*b[e]*b[d]*8),c++;H=a}}var k=Math.floor,m=Array(64),l=Array(64),t=Array(64),v=Array(64),y=Array(65535),n=Array(65535),D=Array(64),x=Array(64),B=[],E=0,C=7,I=Array(64),J=Array(64),K=Array(64),G=Array(256),z=Array(2048),H,F=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],L=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],M=[0,1,2,3,4,5,6,7,8,9,10,11],
N=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],O=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,
210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],P=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Q=[0,1,2,3,4,5,6,7,8,9,10,11],R=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],S=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,
120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];this.encode=function(a,b){b&&g(b);B=[];E=0;C=7;d(65496);d(65504);d(16);c(74);c(70);c(73);c(70);c(0);c(1);c(1);c(0);d(1);d(1);c(0);c(0);d(65499);d(132);c(0);for(b=0;64>b;b++)c(m[b]);c(1);for(b=0;64>b;b++)c(l[b]);
b=a.width;var f=a.height;d(65472);d(17);c(8);d(f);d(b);c(3);c(1);c(17);c(0);c(2);c(17);c(1);c(3);c(17);c(1);d(65476);d(418);c(0);for(b=0;16>b;b++)c(L[b+1]);for(b=0;11>=b;b++)c(M[b]);c(16);for(b=0;16>b;b++)c(N[b+1]);for(b=0;161>=b;b++)c(O[b]);c(1);for(b=0;16>b;b++)c(P[b+1]);for(b=0;11>=b;b++)c(Q[b]);c(17);for(b=0;16>b;b++)c(R[b+1]);for(b=0;161>=b;b++)c(S[b]);d(65498);d(12);c(3);c(1);c(0);c(2);c(17);c(3);c(17);c(0);c(63);c(0);var k=f=b=0;E=0;C=7;this.encode.displayName="_encode_";var y=a.data,n=a.height;
a=4*a.width;for(var p,D=0,q,r,u,A,w;D<n;){for(p=0;p<a;){A=a*D+p;for(w=0;64>w;w++)r=w>>3,q=4*(w&7),u=A+r*a+q,D+r>=n&&(u-=a*(D+1+r-n)),p+q>=a&&(u-=p+q-a+4),q=y[u++],r=y[u++],u=y[u++],I[w]=(z[q]+z[r+256>>0]+z[u+512>>0]>>16)-128,J[w]=(z[q+768>>0]+z[r+1024>>0]+z[u+1280>>0]>>16)-128,K[w]=(z[q+1280>>0]+z[r+1536>>0]+z[u+1792>>0]>>16)-128;b=h(I,t,b,V,W);f=h(J,v,f,T,U);k=h(K,v,k,T,U);p+=32}D+=8}0<=C&&(a=[],a[1]=C+1,a[0]=(1<<C+1)-1,e(a));d(65497);a="data:image/jpeg;base64,"+btoa(B.join(""));B=[];return a};b||
(b=50);(function(){for(var a=String.fromCharCode,b=0;256>b;b++)G[b]=a(b)})();var V=a(L,M);var T=a(P,Q);var W=a(N,O);var U=a(R,S);(function(){for(var a=1,b=2,c=1;15>=c;c++){for(var e=a;e<b;e++)n[32767+e]=c,y[32767+e]=[],y[32767+e][1]=c,y[32767+e][0]=e;for(e=-(b-1);e<=-a;e++)n[32767+e]=c,y[32767+e]=[],y[32767+e][1]=c,y[32767+e][0]=b-1+e;a<<=1;b<<=1}})();(function(){for(var a=0;256>a;a++)z[a]=19595*a,z[a+256>>0]=38470*a,z[a+512>>0]=7471*a+32768,z[a+768>>0]=-11059*a,z[a+1024>>0]=-21709*a,z[a+1280>>0]=
32768*a+8421375,z[a+1536>>0]=-27439*a,z[a+1792>>0]=-5329*a})();g(b)}c.encode=function(b,a){return(new c(a)).encode(b)};return c});m("runtime/html5/androidpatch",["runtime/html5/util","runtime/html5/jpegencoder","base"],function(g,k,h){var c=g.canvasToDataUrl,b;g.canvasToDataUrl=function(a,e,f){if(!h.os.android)return c.apply(null,arguments);if("image/jpeg"===e&&"undefined"===typeof b){var d=c.apply(null,arguments);d=d.split(",");d=~d[0].indexOf("base64")?atob(d[1]):decodeURIComponent(d[1]);d=d.substring(0,
2);b=255===d.charCodeAt(0)&&216===d.charCodeAt(1)}if("image/jpeg"===e&&!b){var g=a.width;var p=a.height;d=a.getContext("2d");return k.encode(d.getImageData(0,0,g,p),f)}return c.apply(null,arguments)}});m("runtime/html5/image",["base","runtime/html5/runtime","runtime/html5/util"],function(g,k,h){return k.register("Image",{modified:!1,init:function(){var c=this,b=new Image;b.onload=function(){c._info={type:c.type,width:this.width,height:this.height};c._metas||"image/jpeg"!==c.type?c.owner.trigger("load"):
h.parseMeta(c._blob,function(a,b){c._metas=b;c.owner.trigger("load")})};b.onerror=function(){c.owner.trigger("error")};c._img=b},loadFromBlob:function(c){var b=this._img;this._blob=c;this.type=c.type;b.src=h.createObjectURL(c.getSource());this.owner.once("load",function(){h.revokeObjectURL(b.src)})},resize:function(c,b){var a=this._canvas||(this._canvas=document.createElement("canvas"));this._resize(this._img,a,c,b);this._blob=null;this.modified=!0;this.owner.trigger("complete","resize")},crop:function(c,
b,a,e,f){var d=this._canvas||(this._canvas=document.createElement("canvas")),h=this.options,g=this._img,k=g.naturalWidth,m=g.naturalHeight,l=this.getOrientation();f=f||1;d.width=a;d.height=e;h.preserveHeaders||this._rotate2Orientaion(d,l);this._renderImageToCanvas(d,g,-c,-b,k*f,m*f);this._blob=null;this.modified=!0;this.owner.trigger("complete","crop")},getAsBlob:function(c){var b=this._blob,a=this.options;c=c||this.type;if(this.modified||this.type!==c){b=this._canvas;if("image/jpeg"===c){if(b=h.canvasToDataUrl(b,
c,a.quality),a.preserveHeaders&&this._metas&&this._metas.imageHead)return b=h.dataURL2ArrayBuffer(b),b=h.updateImageHead(b,this._metas.imageHead),b=h.arrayBufferToBlob(b,c)}else b=h.canvasToDataUrl(b,c);b=h.dataURL2Blob(b)}return b},getAsDataUrl:function(c){var b=this.options;c=c||this.type;return"image/jpeg"===c?h.canvasToDataUrl(this._canvas,c,b.quality):this._canvas.toDataURL(c)},getOrientation:function(){return this._metas&&this._metas.exif&&this._metas.exif.get("Orientation")||1},info:function(c){return c?
(this._info=c,this):this._info},meta:function(c){return c?(this._meta=c,this):this._meta},destroy:function(){var c=this._canvas;this._img.onload=null;c&&(c.getContext("2d").clearRect(0,0,c.width,c.height),c.width=c.height=0,this._canvas=null);this._img.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D";this._img=this._blob=null},_resize:function(c,b,a,e){var f=this.options,d=c.width,h=c.height,g=this.getOrientation();~[5,6,7,8].indexOf(g)&&(a^=e,e^=a,a^=e);var k=Math[f.crop?"max":
"min"](a/d,e/h);f.allowMagnify||(k=Math.min(1,k));d*=k;h*=k;f.crop?(b.width=a,b.height=e):(b.width=d,b.height=h);a=(b.width-d)/2;e=(b.height-h)/2;f.preserveHeaders||this._rotate2Orientaion(b,g);this._renderImageToCanvas(b,c,a,e,d,h)},_rotate2Orientaion:function(c,b){var a=c.width,e=c.height,f=c.getContext("2d");switch(b){case 5:case 6:case 7:case 8:c.width=e,c.height=a}switch(b){case 2:f.translate(a,0);f.scale(-1,1);break;case 3:f.translate(a,e);f.rotate(Math.PI);break;case 4:f.translate(0,e);f.scale(1,
-1);break;case 5:f.rotate(.5*Math.PI);f.scale(1,-1);break;case 6:f.rotate(.5*Math.PI);f.translate(0,-e);break;case 7:f.rotate(.5*Math.PI);f.translate(a,-e);f.scale(-1,1);break;case 8:f.rotate(-.5*Math.PI),f.translate(-a,0)}},_renderImageToCanvas:function(){function c(b,a,c){var e=document.createElement("canvas"),d=e.getContext("2d");a=0;var h=c,g=c;e.width=1;e.height=c;d.drawImage(b,0,0);for(b=d.getImageData(0,0,1,c).data;g>a;)e=b[4*(g-1)+3],0===e?h=g:a=g,g=h+a>>1;c=g/c;return 0===c?1:c}return g.os.ios?
7<=g.os.ios?function(b,a,e,f,d,h){var g=a.naturalWidth,k=a.naturalHeight,m=c(a,g,k);return b.getContext("2d").drawImage(a,0,0,g*m,k*m,e,f,d,h)}:function(b,a,e,f,d,h){var g=a.naturalWidth,k=a.naturalHeight;b=b.getContext("2d");var m=a.naturalWidth;if(1048576<m*a.naturalHeight){var l=document.createElement("canvas");l.width=l.height=1;l=l.getContext("2d");l.drawImage(a,-m+1,0);var t=0===l.getImageData(0,0,1,1).data[3]}else t=!1;var v="image/jpeg"===this.type;l=m=0;var y;t&&(g/=2,k/=2);b.save();t=document.createElement("canvas");
t.width=t.height=1024;var n=t.getContext("2d");v=v?c(a,g,k):1;d=Math.ceil(1024*d/g);for(h=Math.ceil(1024*h/k/v);m<k;){for(y=v=0;v<g;)n.clearRect(0,0,1024,1024),n.drawImage(a,-v,-m),b.drawImage(t,0,0,1024,1024,e+y,f+l,d,h),v+=1024,y+=d;m+=1024;l+=h}b.restore()}:function(b){var a=g.slice(arguments,1),c=b.getContext("2d");c.drawImage.apply(c,a)}}()})});m("runtime/html5/transport",["base","runtime/html5/runtime"],function(g,k){var h=g.noop,c=g.$;return k.register("Transport",{init:function(){this._status=
0;this._response=null},send:function(){var b=this.owner,a=this.options,e=this._initAjax(),f=b._blob,d=a.server;if(a.sendAsBinary){d+=(/\?/.test(d)?"&":"?")+c.param(b._formData);var h=f.getSource()}else{var k=new FormData;c.each(b._formData,function(a,b){k.append(a,b)});k.append(a.fileVal,f.getSource(),a.filename||b._formData.name||"")}a.withCredentials&&"withCredentials"in e?(e.open(a.method,d,!0),e.withCredentials=!0):e.open(a.method,d);this._setRequestHeader(e,a.headers);if(h)if(e.overrideMimeType&&
e.overrideMimeType("application/octet-stream"),g.os.android){var m=new FileReader;m.onload=function(){e.send(this.result);m=m.onload=null};m.readAsArrayBuffer(h)}else e.send(h);else e.send(k)},getResponse:function(){return this._response},getResponseAsJson:function(){return this._parseJson(this._response)},getStatus:function(){return this._status},abort:function(){var b=this._xhr;b&&(b.upload.onprogress=h,b.onreadystatechange=h,b.abort(),this._xhr=null)},destroy:function(){this.abort()},_initAjax:function(){var b=
this,a=new XMLHttpRequest;!this.options.withCredentials||"withCredentials"in a||"undefined"===typeof XDomainRequest||(a=new XDomainRequest);a.upload.onprogress=function(a){var c=0;a.lengthComputable&&(c=a.loaded/a.total);return b.trigger("progress",c)};a.onreadystatechange=function(){if(4===a.readyState)return a.upload.onprogress=h,a.onreadystatechange=h,b._xhr=null,b._status=a.status,200<=a.status&&300>a.status?(b._response=a.responseText,b.trigger("load")):500<=a.status&&600>a.status?(b._response=
a.responseText,b.trigger("error","server")):b.trigger("error",b._status?"http":"abort")};return b._xhr=a},_setRequestHeader:function(b,a){c.each(a,function(a,c){b.setRequestHeader(a,c)})},_parseJson:function(b){try{var a=JSON.parse(b)}catch(e){a={}}return a}})});m("runtime/html5/md5",["runtime/html5/runtime"],function(g){var k=function(a,b){return a+b&4294967295},h=function(a,b,c,e,d,f){b=k(k(b,a),k(e,f));return k(b<<d|b>>>32-d,c)},c=function(a,b,c,e,d,f,g){return h(b&c|~b&e,a,b,d,f,g)},b=function(a,
b,c,e,d,f,g){return h(b&e|c&~e,a,b,d,f,g)},a=function(a,b,c,e,d,f,g){return h(c^(b|~e),a,b,d,f,g)},e=function(e,d){var f=e[0],g=e[1],n=e[2],l=e[3];f=c(f,g,n,l,d[0],7,-680876936);l=c(l,f,g,n,d[1],12,-389564586);n=c(n,l,f,g,d[2],17,606105819);g=c(g,n,l,f,d[3],22,-1044525330);f=c(f,g,n,l,d[4],7,-176418897);l=c(l,f,g,n,d[5],12,1200080426);n=c(n,l,f,g,d[6],17,-1473231341);g=c(g,n,l,f,d[7],22,-45705983);f=c(f,g,n,l,d[8],7,1770035416);l=c(l,f,g,n,d[9],12,-1958414417);n=c(n,l,f,g,d[10],17,-42063);g=c(g,n,
l,f,d[11],22,-1990404162);f=c(f,g,n,l,d[12],7,1804603682);l=c(l,f,g,n,d[13],12,-40341101);n=c(n,l,f,g,d[14],17,-1502002290);g=c(g,n,l,f,d[15],22,1236535329);f=b(f,g,n,l,d[1],5,-165796510);l=b(l,f,g,n,d[6],9,-1069501632);n=b(n,l,f,g,d[11],14,643717713);g=b(g,n,l,f,d[0],20,-373897302);f=b(f,g,n,l,d[5],5,-701558691);l=b(l,f,g,n,d[10],9,38016083);n=b(n,l,f,g,d[15],14,-660478335);g=b(g,n,l,f,d[4],20,-405537848);f=b(f,g,n,l,d[9],5,568446438);l=b(l,f,g,n,d[14],9,-1019803690);n=b(n,l,f,g,d[3],14,-187363961);
g=b(g,n,l,f,d[8],20,1163531501);f=b(f,g,n,l,d[13],5,-1444681467);l=b(l,f,g,n,d[2],9,-51403784);n=b(n,l,f,g,d[7],14,1735328473);g=b(g,n,l,f,d[12],20,-1926607734);f=h(g^n^l,f,g,d[5],4,-378558);l=h(f^g^n,l,f,d[8],11,-2022574463);n=h(l^f^g,n,l,d[11],16,1839030562);g=h(n^l^f,g,n,d[14],23,-35309556);f=h(g^n^l,f,g,d[1],4,-1530992060);l=h(f^g^n,l,f,d[4],11,1272893353);n=h(l^f^g,n,l,d[7],16,-155497632);g=h(n^l^f,g,n,d[10],23,-1094730640);f=h(g^n^l,f,g,d[13],4,681279174);l=h(f^g^n,l,f,d[0],11,-358537222);n=
h(l^f^g,n,l,d[3],16,-722521979);g=h(n^l^f,g,n,d[6],23,76029189);f=h(g^n^l,f,g,d[9],4,-640364487);l=h(f^g^n,l,f,d[12],11,-421815835);n=h(l^f^g,n,l,d[15],16,530742520);g=h(n^l^f,g,n,d[2],23,-995338651);f=a(f,g,n,l,d[0],6,-198630844);l=a(l,f,g,n,d[7],10,1126891415);n=a(n,l,f,g,d[14],15,-1416354905);g=a(g,n,l,f,d[5],21,-57434055);f=a(f,g,n,l,d[12],6,1700485571);l=a(l,f,g,n,d[3],10,-1894986606);n=a(n,l,f,g,d[10],15,-1051523);g=a(g,n,l,f,d[1],21,-2054922799);f=a(f,g,n,l,d[8],6,1873313359);l=a(l,f,g,n,d[15],
10,-30611744);n=a(n,l,f,g,d[6],15,-1560198380);g=a(g,n,l,f,d[13],21,1309151649);f=a(f,g,n,l,d[4],6,-145523070);l=a(l,f,g,n,d[11],10,-1120210379);n=a(n,l,f,g,d[2],15,718787259);g=a(g,n,l,f,d[9],21,-343485551);e[0]=k(f,e[0]);e[1]=k(g,e[1]);e[2]=k(n,e[2]);e[3]=k(l,e[3])},f=function(a){var b=[],c;for(c=0;64>c;c+=4)b[c>>2]=a.charCodeAt(c)+(a.charCodeAt(c+1)<<8)+(a.charCodeAt(c+2)<<16)+(a.charCodeAt(c+3)<<24);return b},d=function(a){var b=[],c;for(c=0;64>c;c+=4)b[c>>2]=a[c]+(a[c+1]<<8)+(a[c+2]<<16)+(a[c+
3]<<24);return b},m=function(a){var b=a.length,c=[1732584193,-271733879,-1732584194,271733878],d;for(d=64;d<=b;d+=64)e(c,f(a.substring(d-64,d)));a=a.substring(d-64);var g=a.length;var h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<g;d+=1)h[d>>2]|=a.charCodeAt(d)<<(d%4<<3);h[d>>2]|=128<<(d%4<<3);if(55<d)for(e(c,h),d=0;16>d;d+=1)h[d]=0;b=(8*b).toString(16).match(/(.*?)(.{0,8})$/);a=parseInt(b[2],16);b=parseInt(b[1],16)||0;h[14]=a;h[15]=b;e(c,h);return c},p="0123456789abcdef".split(""),u=function(a){var b;
for(b=0;b<a.length;b+=1){var c=b,d,e=a[b],f="";for(d=0;4>d;d+=1)f+=p[e>>8*d+4&15]+p[e>>8*d&15];a[c]=f}return a.join("")},r=function(){this.reset()};"5d41402abc4b2a76b9719d911017c592"!==u(m("hello"))&&(k=function(a,b){var c=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(c>>16)<<16|c&65535});r.prototype.append=function(a){/[\u0080-\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a)));this.appendBinary(a);return this};r.prototype.appendBinary=function(a){this._buff+=a;this._length+=a.length;a=this._buff.length;
var b;for(b=64;b<=a;b+=64)e(this._state,f(this._buff.substring(b-64,b)));this._buff=this._buff.substr(b-64);return this};r.prototype.end=function(a){var b=this._buff,c=b.length,d,e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<c;d+=1)e[d>>2]|=b.charCodeAt(d)<<(d%4<<3);this._finish(e,c);a=a?this._state:u(this._state);this.reset();return a};r.prototype._finish=function(a,b){a[b>>2]|=128<<(b%4<<3);if(55<b)for(e(this._state,a),b=0;16>b;b+=1)a[b]=0;var c=8*this._length;c=c.toString(16).match(/(.*?)(.{0,8})$/);
b=parseInt(c[2],16);c=parseInt(c[1],16)||0;a[14]=b;a[15]=c;e(this._state,a)};r.prototype.reset=function(){this._buff="";this._length=0;this._state=[1732584193,-271733879,-1732584194,271733878];return this};r.prototype.destroy=function(){delete this._state;delete this._buff;delete this._length};r.hash=function(a,b){/[\u0080-\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a)));a=m(a);return b?a:u(a)};r.hashBinary=function(a,b){a=m(a);return b?a:u(a)};r.ArrayBuffer=function(){this.reset()};r.ArrayBuffer.prototype.append=
function(a){var b=this._concatArrayBuffer(this._buff,a),c=b.length;this._length+=a.byteLength;for(a=64;a<=c;a+=64)e(this._state,d(b.subarray(a-64,a)));this._buff=a-64<c?b.subarray(a-64):new Uint8Array(0);return this};r.ArrayBuffer.prototype.end=function(a){var b=this._buff,c=b.length,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e;for(e=0;e<c;e+=1)d[e>>2]|=b[e]<<(e%4<<3);this._finish(d,c);a=a?this._state:u(this._state);this.reset();return a};r.ArrayBuffer.prototype._finish=r.prototype._finish;r.ArrayBuffer.prototype.reset=
function(){this._buff=new Uint8Array(0);this._length=0;this._state=[1732584193,-271733879,-1732584194,271733878];return this};r.ArrayBuffer.prototype.destroy=r.prototype.destroy;r.ArrayBuffer.prototype._concatArrayBuffer=function(a,b){var c=a.length,d=new Uint8Array(c+b.byteLength);d.set(a);d.set(new Uint8Array(b),c);return d};r.ArrayBuffer.hash=function(a,b){var c=new Uint8Array(a),f=c.length;a=[1732584193,-271733879,-1732584194,271733878];var g;for(g=64;g<=f;g+=64)e(a,d(c.subarray(g-64,g)));c=g-
64<f?c.subarray(g-64):new Uint8Array(0);var h=c.length;var k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(g=0;g<h;g+=1)k[g>>2]|=c[g]<<(g%4<<3);k[g>>2]|=128<<(g%4<<3);if(55<g)for(e(a,k),g=0;16>g;g+=1)k[g]=0;f=(8*f).toString(16).match(/(.*?)(.{0,8})$/);c=parseInt(f[2],16);f=parseInt(f[1],16)||0;k[14]=c;k[15]=f;e(a,k);return b?a:u(a)};return g.register("Md5",{init:function(){},loadFromBlob:function(a){var b=a.getSource(),c=Math.ceil(b.size/2097152),d=0,e=this.owner,f=new r.ArrayBuffer,g=this,h=b.mozSlice||
b.webkitSlice||b.slice;var k=new FileReader;var l=function(){var m=2097152*d;var n=Math.min(m+2097152,b.size);k.onload=function(b){f.append(b.target.result);e.trigger("progress",{total:a.size,loaded:n})};k.onloadend=function(){k.onloadend=k.onload=null;++d<c?setTimeout(l,1):setTimeout(function(){e.trigger("load");g.result=f.end();l=a=b=f=null;e.trigger("complete")},50)};k.readAsArrayBuffer(h.call(b,m,n))};l()},getResult:function(){return this.result}})});m("runtime/flash/runtime",["base","runtime/runtime",
"runtime/compbase"],function(g,k,h){function c(){function b(a,b){var c=a.type||a;c=c.split("::");var e=c[0];c=c[1];"Ready"===c&&e===m.uid?m.trigger("ready"):d[e]&&d[e].trigger(c.toLowerCase(),a,b)}var c={},d={},h=this.destroy,m=this,u=g.guid("webuploader_");k.apply(m,arguments);m.type="flash";m.exec=function(b,e){var f=this.uid,h=g.slice(arguments,2);d[f]=this;return a[b]&&(c[f]||(c[f]=new a[b](this,m)),f=c[f],f[e])?f[e].apply(f,h):m.flashExec.apply(this,arguments)};x[u]=function(){var a=arguments;
setTimeout(function(){b.apply(null,a)},1)};this.jsreciver=u;this.destroy=function(){return h&&h.apply(this,arguments)};this.flashExec=function(a,b){var c=m.getFlash(),d=g.slice(arguments,2);return c.exec(this.uid,a,b,d)}}var b=g.$,a={};g.inherits(k,{constructor:c,init:function(){var a=this.getContainer(),b=this.options;a.css({position:"absolute",zIndex:29891014,top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"});var c='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+
b.swf+'" ';g.browser.ie&&(c+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ');c+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+b.swf+'" /><param name="flashvars" value="uid='+this.uid+"&jsreciver="+this.jsreciver+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>';a.html(c)},getFlash:function(){return this._flash?this._flash:this._flash=b("#"+this.uid).get(0)}});c.register=function(c,f){return f=a[c]=g.inherits(h,
b.extend({flashExec:function(){var a=this.owner;return this.getRuntime().flashExec.apply(a,arguments)}},f))};11.4<=function(){try{var a=navigator.plugins["Shockwave Flash"];a=a.description}catch(f){try{a=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(d){a="0.0"}}a=a.match(/\d+/g);return parseFloat(a[0]+"."+a[1],10)}()&&k.addRuntime("flash",c);return c});m("runtime/flash/filepicker",["base","runtime/flash/runtime"],function(g,k){var h=g.$;return k.register("FilePicker",
{init:function(c){c=h.extend({},c);var b;var a=c.accept&&c.accept.length;for(b=0;b<a;b++)c.accept[b].title||(c.accept[b].title="Files");delete c.button;delete c.id;delete c.container;this.flashExec("FilePicker","init",c)},destroy:function(){this.flashExec("FilePicker","destroy")}})});m("runtime/flash/image",["runtime/flash/runtime"],function(g){return g.register("Image",{loadFromBlob:function(g){var h=this.owner;h.info()&&this.flashExec("Image","info",h.info());h.meta()&&this.flashExec("Image","meta",
h.meta());this.flashExec("Image","loadFromBlob",g.uid)}})});m("runtime/flash/transport",["base","runtime/flash/runtime","runtime/client"],function(g,k,h){var c=g.$;return k.register("Transport",{init:function(){this._status=0;this._responseJson=this._response=null},send:function(){var b=this.owner,a=this.options,e=this._initAjax(),f=b._blob,d=a.server;e.connectRuntime(f.ruid);if(a.sendAsBinary){d+=(/\?/.test(d)?"&":"?")+c.param(b._formData);var g=f.uid}else c.each(b._formData,function(a,b){e.exec("append",
a,b)}),e.exec("appendBlob",a.fileVal,f.uid,a.filename||b._formData.name||"");this._setRequestHeader(e,a.headers);e.exec("send",{method:a.method,url:d,forceURLStream:a.forceURLStream,mimeType:"application/octet-stream"},g)},getStatus:function(){return this._status},getResponse:function(){return this._response||""},getResponseAsJson:function(){return this._responseJson},abort:function(){var b=this._xhr;b&&(b.exec("abort"),b.destroy(),this._xhr=null)},destroy:function(){this.abort()},_initAjax:function(){var b=
this,a=new h("XMLHttpRequest");a.on("uploadprogress progress",function(a){a=a.loaded/a.total;a=Math.min(1,Math.max(0,a));return b.trigger("progress",a)});a.on("load",function(){var c=a.exec("getStatus"),f=!1,d="";a.off();b._xhr=null;200<=c&&300>c?f=!0:500<=c&&600>c?(f=!0,d="server"):d="http";f&&(b._response=a.exec("getResponse"),b._response=decodeURIComponent(b._response),c=x.JSON&&x.JSON.parse||function(a){try{return(new Function("return "+a)).call()}catch(p){return{}}},b._responseJson=b._response?
c(b._response):{});a.destroy();a=null;return d?b.trigger("error",d):b.trigger("load")});a.on("error",function(){a.off();b._xhr=null;b.trigger("error","http")});return b._xhr=a},_setRequestHeader:function(b,a){c.each(a,function(a,c){b.exec("setRequestHeader",a,c)})}})});m("runtime/flash/blob",["runtime/flash/runtime","lib/blob"],function(g,k){return g.register("Blob",{slice:function(g,c){g=this.flashExec("Blob","slice",g,c);return new k(g.uid,g)}})});m("runtime/flash/md5",["runtime/flash/runtime"],
function(g){return g.register("Md5",{init:function(){},loadFromBlob:function(g){return this.flashExec("Md5","loadFromBlob",g.uid)}})});m("preset/all","base widgets/filednd widgets/filepaste widgets/filepicker widgets/image widgets/queue widgets/runtime widgets/upload widgets/validator widgets/md5 runtime/html5/blob runtime/html5/dnd runtime/html5/filepaste runtime/html5/filepicker runtime/html5/imagemeta/exif runtime/html5/androidpatch runtime/html5/image runtime/html5/transport runtime/html5/md5 runtime/flash/filepicker runtime/flash/image runtime/flash/transport runtime/flash/blob runtime/flash/md5".split(" "),
function(g){return g});m("widgets/log",["base","uploader","widgets/widget"],function(g,k){function h(a){a=c.extend({},b,a);a=" http://static.tieba.baidu.com/tb/pms/img/st.gif??".replace(/^(.*)\?/,"$1"+c.param(a));(new Image).src=a}var c=g.$;g=(location.hostname||location.host||"protected").toLowerCase();if(g&&/baidu/i.exec(g)){var b={dv:3,master:"webuploader",online:/test/.exec(g)?0:1,module:"",product:g,type:0};return k.register({name:"log",init:function(){var a=0,b=0;this.owner.on("error",function(a){h({type:2,
c_error_code:a})}).on("uploadError",function(a,b){h({type:2,c_error_code:"UPLOAD_ERROR",c_reason:""+b})}).on("uploadComplete",function(c){a++;b+=c.size}).on("uploadFinished",function(){h({c_count:a,c_size:b});a=b=0});h({c_usage:1})}})}});m("webuploader",["preset/all","widgets/log"],function(g){return g});return B("webuploader")});
